<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes das Avalia√ß√µes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f0f0f0; }
        .details-container { margin-top: 10vh; }
        .logo { max-width: 200px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container d-flex justify-content-center align-items-center details-container">
        <div class="col-md-8 col-lg-6 bg-white p-5 rounded shadow">
            <div class="text-center">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" class="logo">
                <h3 class="mb-3">Detalhes das Avalia√ß√µes - {{ tipo_usuario }}</h3>
            </div>
            <canvas id="graficoDetalhes"></canvas>
            <ul class="list-group mt-4">
                {% for satisfacao, qtd in dados %}
                    {% if satisfacao == '0' %}
                        {% set emoji = "üò°" %}
                    {% elif satisfacao == '1' %}
                        {% set emoji = "üòü" %}
                    {% elif satisfacao == '2' %}
                        {% set emoji = "üòê" %}
                    {% elif satisfacao == '3' %}
                        {% set emoji = "üôÇ" %}
                    {% elif satisfacao == '4' %}
                        {% set emoji = "üòÄ" %}
                    {% else %}
                        {% set emoji = "ü§î" %}
                    {% endif %}
                    
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Satisfa√ß√£o {{ emoji }}
                        <span class="badge bg-primary rounded-pill">{{ qtd }}</span>
                    </li>
                {% endfor %}
            </ul>
            <p></p>
            <div class="text-center">
                <h5 class="mb-3">Coment√°rios</h5>
            </div>
            <ul class="list-group mt-4">
                {% for i in comentarios %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        "{{ i[0] }}"
                    </li>
                {% endfor %}
            </ul>

            <a href="{{ url_for('painel') }}" class="btn btn-secondary mt-3 w-100">Voltar</a>
        </div>
    </div>
    
    <script>
        // Fun√ß√£o para mapear satisfa√ß√£o para emoji
        function getEmoji(satisfacao) {
            const emojis = {
                '0': 'üò°',
                '1': 'üòü',
                '2': 'üòê',
                '3': 'üôÇ',
                '4': 'üòÄ',
            };
            return emojis[satisfacao] || 'ü§î';
        }

        const labels = [{% for satisfacao, qtd in dados %} getEmoji('{{ satisfacao }}'), {% endfor %}];
        const dadosQuantidades = [{% for satisfacao, qtd in dados %} {{ qtd }}, {% endfor %}];
        
        const ctxDetalhes = document.getElementById('graficoDetalhes').getContext('2d');
        new Chart(ctxDetalhes, {
            type: 'pie',
            data: {
                labels: labels,  // Labels com emojis
                datasets: [{
                    label: 'Quantidade',
                    data: dadosQuantidades,  // Quantidade de respostas
                    backgroundColor: ['#ff0000', '#ff8000', '#ffff00', '#80ff00', '#008000']
                }]
            },
            options: { responsive: true }
        });
        function verificarSessao(event) {
            event.preventDefault();
            fetch("{{ url_for('painel') }}", { method: "GET" })
                .then(response => {
                    if (response.redirected) {
                        window.location.href = response.url;
                    } else {
                        window.location.href = "{{ url_for('painel') }}";
                    }
                });
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
