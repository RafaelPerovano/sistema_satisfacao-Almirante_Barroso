<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes das Avalia√ß√µes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f0f0f0; }
        .details-container { margin-top: 10vh; }
        .logo { max-width: 200px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container d-flex justify-content-center align-items-center details-container">
        <div class="col-md-8 col-lg-6 bg-white p-5 rounded shadow">
            <div class="text-center">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo" class="logo">
                <h3 class="mb-3">Detalhes das Avalia√ß√µes - {{ tipo_usuario }}</h3>
            </div>

            <!-- Filtro por Data -->
            <div class="mb-3">
                <label for="data_inicio" class="form-label">Data In√≠cio:</label>
                <input type="date" id="data_inicio" class="form-control">
                <label for="data_fim" class="form-label mt-2">Data Fim:</label>
                <input type="date" id="data_fim" class="form-control">
                <button class="btn btn-primary w-100 mt-3" onclick="atualizarGrafico()">Filtrar</button>
            </div>

            <canvas id="graficoDetalhes"></canvas>

            <ul class="list-group mt-4" id="lista-avaliacoes"></ul>

            <div class="text-center">
                <h5 class="mb-3">Coment√°rios</h5>
            </div>
            <ul class="list-group mt-4" id="lista-comentarios"></ul>

            <a href="{{ url_for('painel') }}" class="btn btn-secondary mt-3 w-100">Voltar</a>
        </div>
    </div>

    <script>
        let chart;
        function getEmoji(satisfacao) {
            const emojis = { '0': 'üò°', '1': 'üòü', '2': 'üòê', '3': 'üôÇ', '4': 'üòÄ' };
            return emojis[satisfacao] || 'ü§î';
        }

        function atualizarGrafico() {
            const dataInicio = document.getElementById('data_inicio').value;
            const dataFim = document.getElementById('data_fim').value;
            const tipo = "{{ tipo_usuario }}";

            fetch(`/dados_detalhes_avaliacoes?data_inicio=${dataInicio}&data_fim=${dataFim}&tipo=${tipo}`)
                .then(response => response.json())
                .then(data => {
                    const labels = Object.keys(data.dados).map(getEmoji);
                    const valores = Object.values(data.dados);
                    
                    if (chart) chart.destroy();
                    
                    const ctx = document.getElementById('graficoDetalhes').getContext('2d');
                    chart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: labels,
                            datasets: [{ label: 'Quantidade', data: valores, backgroundColor: ['#ff0000', '#ff8000', '#ffff00', '#80ff00', '#008000'] }]
                        },
                        options: { responsive: true }
                    });

                    const listaAvaliacao = document.getElementById('lista-avaliacoes');
                    listaAvaliacao.innerHTML = labels.map((emoji, i) => 
                        `<li class="list-group-item d-flex justify-content-between align-items-center">
                            Satisfa√ß√£o ${emoji}
                            <span class="badge bg-primary rounded-pill">${valores[i]}</span>
                        </li>`).join('');

                    const listaComentarios = document.getElementById('lista-comentarios');
                    listaComentarios.innerHTML = data.comentarios.map(comentario => 
                        `<li class="list-group-item">"${comentario}"</li>`).join('');
                });
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
